
version: "2"

services:
  flask:
    image: unocha/alpine-base-python3
    container_name: fun-flask
    hostname: fun-flask
    volumes:
      - "./app:/opt"
    environment:
      - FLASK_APP=/opt/app.py
    entrypoint:
      - "/opt/runapp.sh"
    networks:
      dbnet:
      appnet:
        aliases:
          - app

  mongo:
    image: unocha/alpine-mongo
    container_name: mongo
    hostname: mongo
    volumes:
      - "./db:/srv/db"
      - "./db:/opt"
    networks:
      - dbnet

  web:
    image: unocha/alpine-nginx-extras
    build: .
    container_name: web
    hostname: web
    ports:
      - "0.0.0.0:80:80"
    volumes:
      - "./app:/srv/www/html"
      - "./web:/etc/nginx/conf.d"
    networks:
      default:
        aliases:
          - web.fun.net
      appnet:
        aliases:
          - gw.fun.net

networks:
  dbnet:
  appnet:
